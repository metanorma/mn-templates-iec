# Auto-generated !!! Do not edit it manually
# use ci-master https://github.com/metanorma/metanorma-build-scripts
version: '{build}'

environment:
  matrix:
    - RUBY_VERSION: 25

install:
  - ps: . { iwr -useb https://raw.githubusercontent.com/metanorma/metanorma-build-scripts/master/appveyor.ps1 } | iex
  - refreshenv
  - set PATH=C:\Ruby%RUBY_VERSION%\bin;%PATH%
  - gem install metanorma-cli
  - FOR /F "tokens=1,2 delims==" %%G IN (doctypes.env) DO (set %%G=%%H)
  - set DOCTYPES=%DOCTYPES:"=% # https://stackoverflow.com/a/5181182/902217
  - gem install metanorma-%TYPE%

before_build:
  - ruby -v
  - gem -v

build_script:
  - ps: |
      $docTypes = ConvertFrom-StringData (Get-Content ./doctypes.env -Raw)
      $docTypes.DOCTYPES.Split(" ") | ForEach {
        $t = $_.Trim('"')
        metanorma new result\$t --type $docTypes.TYPE --doctype $t --template . --overwrite
        if (Test-Path -Path $env:APPVEYOR_BUILD_FOLDER\result\$t\document.adoc) {
          metanorma compile $env:APPVEYOR_BUILD_FOLDER\result\$t\document.adoc
        } else {
          Get-ChildItem "$env:APPVEYOR_BUILD_FOLDER\result\$t" -Filter *.adoc | Foreach-Object {
            metanorma compile $_.FullName
          }
        }
      }
  - 7z a %APPVEYOR_BUILD_FOLDER%\result.zip %APPVEYOR_BUILD_FOLDER%\result

artifacts:
  - path: result.zip
    name: result.zip
